NERSCLOG(verbose): key=mods-test
NERSCLOG(verbose): adding stdout streamhandler
NERSCLOG(verbose): missing <prio> prefix in stream output will be present in message for syslog
1 2020-11-22T11:52:45.789156-08:00 nid00677 mods-test - p0-20201118t175133 [nerscjson@42] {"category": "mods-test", "service": "spark", "duration_seconds": 0, "event_timestamp": "2020-11-22T11:52:45.762725-08:00", "is_compute": true, "is_staff": false, "job_id": "36494246", "num_nodes": "64", "repo": "m1727", "subservice": null, "subsystem": "Haswell", "system": "Cori", "username": "plaszczy", "version": "2.4.4"}
data sent to mods
SPARKVERSION=2.4.4
SPARK_WORKER_DIR=/global/cscratch1/sd/plaszczy/spark/36494246
SPARK_VERSION=2.4.4
SPARK_SLAVES=/global/cscratch1/sd/plaszczy/spark/36494246/slaves
SPARK_LOCAL_DIRS=/tmp
SPARK_HOME=/usr/local/bin/spark-2.4.4
SPARKURL=spark://nid00677:7077
SPARK_NO_DAEMONIZE=no
SPARK_MASTER_HOST=nid00677
SPARK_CONF_DIR=/global/cscratch1/sd/plaszczy/spark/36494246/conf
SPARK_HELPER=/usr/local/bin/spark-2.4.4/helpers/
calling srun -N 63 -n 63 -x nid00677 env -u SHIFTER_VOLUME shifter /usr/local/bin/spark-2.4.4/sbin/start-slave.sh spark://nid00677:7077
mem=6400
cores=2016

#binning
Nbins=20
bin_min=2.5
bin_max=250
bin_type=log

#bin range
imin=0
imax=15

#tilingJ=cubedSphere
tilingJ=SARSPix
tilingR=SARSPix

# input data
data1=/global/cscratch1/sd/plaszczy/tomo100M.parquet
#data1=/global/homes/p/plaszczy/data/tomo100M.parquet
ra_name=RA
dec_name=DEC
calling /usr/local/bin/spark-2.4.4/sbin/spark-config.sh
calling shifter /usr/local/bin/spark-2.4.4/sbin/start-master.sh
starting org.apache.spark.deploy.master.Master, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.master.Master-1-nid00677.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00745.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00684.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00723.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00700.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00737.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00689.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00742.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00722.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00736.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00697.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00680.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00679.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00690.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00744.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00695.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00703.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00681.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00716.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00735.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00692.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00686.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00693.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00726.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00724.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00725.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00720.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00698.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00682.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00687.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00713.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00721.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00728.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00701.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00729.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00715.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00688.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00717.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00740.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00683.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00733.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00731.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00730.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00699.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00696.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00741.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00727.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00732.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00705.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00702.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00691.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00678.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00712.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00714.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00743.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00739.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00707.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00706.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00685.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00734.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00738.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00694.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00719.out
Parsing tomo100M.par_11809: --> Nbins=20
Parsing tomo100M.par_11809: --> bin_min=2.5
Parsing tomo100M.par_11809: --> bin_max=250
Parsing tomo100M.par_11809: --> bin_type=log
Parsing tomo100M.par_11809: --> data1=/global/cscratch1/sd/plaszczy/tomo100M.parquet
Parsing tomo100M.par_11809: --> ra_name=RA
Parsing tomo100M.par_11809: --> dec_name=DEC
Parsing tomo100M.par_11809: --> tilingJ=SARSPix
Parsing tomo100M.par_11809: --> imin=0
Parsing tomo100M.par_11809: --> imax=15
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36494246/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00718.out
+----+----------------------------------------+------------------+
|ibin|interval                                |width             |
+----+----------------------------------------+------------------+
|0   |[2.5, 3.1473135294854178]               |0.6473135294854178|
|1   |[3.1473135294854178, 3.962232981152783] |0.8149194516673655|
|2   |[3.962232981152783, 4.988155787422199]  |1.0259228062694161|
|3   |[4.988155787422199, 6.2797160787739505] |1.2915602913517512|
|4   |[6.2797160787739505, 7.905694150420946] |1.6259780716469958|
|5   |[7.905694150420946, 9.952679263837432]  |2.0469851134164854|
|6   |[9.952679263837432, 12.529680840681802] |2.5770015768443706|
|7   |[12.529680840681802, 15.77393361200483] |3.244252771323028 |
|8   |[15.77393361200483, 19.858205868107035] |4.084272256102205 |
|9   |[19.858205868107035, 24.999999999999996]|5.141794131892961 |
|10  |[24.999999999999996, 31.473135294854174]|6.473135294854178 |
|11  |[31.473135294854174, 39.62232981152784] |8.149194516673667 |
|12  |[39.62232981152784, 49.88155787422197]  |10.259228062694127|
|13  |[49.88155787422197, 62.7971607877395]   |12.915602913517532|
|14  |[62.7971607877395, 79.05694150420948]   |16.259780716469976|
|15  |[79.05694150420948, 99.5267926383743]   |20.469851134164827|
+----+----------------------------------------+------------------+

reading input data=/global/cscratch1/sd/plaszczy/tomo100M.parquet
root
 |-- RA: float (nullable = true)
 |-- DEC: float (nullable = true)
 |-- z: float (nullable = true)

* SARSPix pixelization: Nbase=40 Npix=0.00960000M
source #part=6048
*** caching source: id, ipix, x_s, y_s, z_s
Source size=97.74 M

input source: 16.5s (0.28min)
----------------------------------------
+-------------+----+------------------+-------------------+-------------------+
|           id|ipix|               x_s|                y_s|                z_s|
+-------------+----+------------------+-------------------+-------------------+
|1185411001397|1195|0.5821262805709131|-0.5064583188914499|-0.6361045234034427|
|1185411005475|1195|0.5820731858230501|-0.5076640922659538|-0.6351912906909147|
|1185411005488|1195| 0.582583767542825|-0.5070139170309597|-0.6352425062387834|
|1185411005508|1195|0.5825715480655801|-0.5065481218850433|-0.6356251974231425|
|1185411009650|1195|0.5809218966170656|-0.5094488089432839| -0.634816241992201|
+-------------+----+------------------+-------------------+-------------------+
only showing top 5 rows

*** caching duplicates: id2, x_t, y_t, z_t, ipix
duplicates size=879.39 M
+-------------+------------------+-------------------+-------------------+----+
|          id2|               x_t|                y_t|                z_t|ipix|
+-------------+------------------+-------------------+-------------------+----+
|2491081032494|0.6053350672331774|-0.5178620805120108|-0.6044735907759545|1195|
|2491081032495|0.6058673636928917|-0.5181207628243597|-0.6037181567106699|1195|
|2491081032496|0.6060254834676173| -0.517815766428126|-0.6038211203877297|1195|
|2491081032503|0.6061637788958578|-0.5171764113261718|-0.6042301157030127|1195|
|2491081032517|0.6079575436565013|-0.5152941781867494|-0.6040360378636326|1195|
+-------------+------------------+-------------------+-------------------+----+
only showing top 5 rows


dup cache: 25.0s (0.42min)
----------------------------------------
dup partitions=6048
pairs:
root
 |-- x_s: double (nullable = true)
 |-- y_s: double (nullable = true)
 |-- z_s: double (nullable = true)
 |-- x_t: double (nullable = true)
 |-- y_t: double (nullable = true)
 |-- z_t: double (nullable = true)

edges:
root
 |-- bin: integer (nullable = true)

edges numParts=6048
==> joining bin

join: 0.6s (0.01min)
----------------------------------------
#bins=16
+---+------------+
|bin|        Nbin|
+---+------------+
|  0|   506727642|
|  1|   800041282|
|  2|  1260509592|
|  3|  1979959475|
|  4|  3096818992|
|  5|  4815924052|
|  6|  7438665544|
|  7| 11411877241|
|  8| 17425875136|
|  9| 26591445306|
| 10| 40723594728|
| 11| 62746460926|
| 12| 97293945900|
| 13|151684971831|
| 14|237573071187|
| 15|373467108791|
+---+------------+


binning: 447.7s (7.46min)
----------------------------------------
TOT TIME=8.163662045216666 mins
Summary: ************************************
@sarspix(40)
x@ imin imax Ndata Ndup nedges Nj NpixJ nodes part1 part2 part3 ts td tj tb t
x@@ 0 15 97736948 879393017 1.03882e+12 40 9600 64 6048 6048 6048 16 25 0 447 8.16
+----+----------------------------------------+------------------+------------+
|ibin|interval                                |width             |Nbin        |
+----+----------------------------------------+------------------+------------+
|0   |[2.5, 3.1473135294854178]               |0.6473135294854178|506727642   |
|1   |[3.1473135294854178, 3.962232981152783] |0.8149194516673655|800041282   |
|2   |[3.962232981152783, 4.988155787422199]  |1.0259228062694161|1260509592  |
|3   |[4.988155787422199, 6.2797160787739505] |1.2915602913517512|1979959475  |
|4   |[6.2797160787739505, 7.905694150420946] |1.6259780716469958|3096818992  |
|5   |[7.905694150420946, 9.952679263837432]  |2.0469851134164854|4815924052  |
|6   |[9.952679263837432, 12.529680840681802] |2.5770015768443706|7438665544  |
|7   |[12.529680840681802, 15.77393361200483] |3.244252771323028 |11411877241 |
|8   |[15.77393361200483, 19.858205868107035] |4.084272256102205 |17425875136 |
|9   |[19.858205868107035, 24.999999999999996]|5.141794131892961 |26591445306 |
|10  |[24.999999999999996, 31.473135294854174]|6.473135294854178 |40723594728 |
|11  |[31.473135294854174, 39.62232981152784] |8.149194516673667 |62746460926 |
|12  |[39.62232981152784, 49.88155787422197]  |10.259228062694127|97293945900 |
|13  |[49.88155787422197, 62.7971607877395]   |12.915602913517532|151684971831|
|14  |[62.7971607877395, 79.05694150420948]   |16.259780716469976|237573071187|
|15  |[79.05694150420948, 99.5267926383743]   |20.469851134164827|373467108791|
+----+----------------------------------------+------------------+------------+

+-------------+
|    sum(Nbin)|
+-------------+
|1038816997625|
+-------------+

