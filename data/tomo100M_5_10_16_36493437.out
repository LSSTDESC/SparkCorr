NERSCLOG(verbose): key=mods-test
NERSCLOG(verbose): adding stdout streamhandler
NERSCLOG(verbose): missing <prio> prefix in stream output will be present in message for syslog
1 2020-11-22T09:55:02.499759-08:00 nid00634 mods-test - p0-20201118t175133 [nerscjson@42] {"category": "mods-test", "service": "spark", "duration_seconds": 0, "event_timestamp": "2020-11-22T09:55:02.469825-08:00", "is_compute": true, "is_staff": false, "job_id": "36493437", "num_nodes": "16", "repo": "m1727", "subservice": null, "subsystem": "Haswell", "system": "Cori", "username": "plaszczy", "version": "2.4.4"}
data sent to mods
SPARKVERSION=2.4.4
SPARK_WORKER_DIR=/global/cscratch1/sd/plaszczy/spark/36493437
SPARK_VERSION=2.4.4
SPARK_SLAVES=/global/cscratch1/sd/plaszczy/spark/36493437/slaves
SPARK_LOCAL_DIRS=/tmp
SPARK_HOME=/usr/local/bin/spark-2.4.4
SPARKURL=spark://nid00634:7077
SPARK_NO_DAEMONIZE=no
SPARK_MASTER_HOST=nid00634
SPARK_CONF_DIR=/global/cscratch1/sd/plaszczy/spark/36493437/conf
SPARK_HELPER=/usr/local/bin/spark-2.4.4/helpers/
calling srun -N 15 -n 15 -x nid00634 env -u SHIFTER_VOLUME shifter /usr/local/bin/spark-2.4.4/sbin/start-slave.sh spark://nid00634:7077
mem=1600
cores=480

#binning
Nbins=20
bin_min=2.5
bin_max=250
bin_type=log

#bin range
imin=5
imax=10

#tilingJ=cubedSphere
tilingJ=SARSPix
tilingR=SARSPix

# input data
data1=/global/cscratch1/sd/plaszczy/tomo100M.parquet
#data1=/global/homes/p/plaszczy/data/tomo100M.parquet
ra_name=RA
dec_name=DEC
calling /usr/local/bin/spark-2.4.4/sbin/spark-config.sh
calling shifter /usr/local/bin/spark-2.4.4/sbin/start-master.sh
starting org.apache.spark.deploy.master.Master, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.master.Master-1-nid00634.out
Parsing tomo100M.par_20856: --> Nbins=20
Parsing tomo100M.par_20856: --> bin_min=2.5
Parsing tomo100M.par_20856: --> bin_max=250
Parsing tomo100M.par_20856: --> bin_type=log
Parsing tomo100M.par_20856: --> imin=5
Parsing tomo100M.par_20856: --> imax=10
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00637.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00655.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00658.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00654.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00635.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00653.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00639.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00646.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00636.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00657.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00656.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00652.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00638.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00647.out
starting org.apache.spark.deploy.worker.Worker, logging to /global/cscratch1/sd/plaszczy/spark/36493437/spark-plaszczy-org.apache.spark.deploy.worker.Worker-1-nid00645.out
+----+----------------------------------------+------------------+
|ibin|interval                                |width             |
+----+----------------------------------------+------------------+
|5   |[7.905694150420946, 9.952679263837432]  |2.0469851134164854|
|6   |[9.952679263837432, 12.529680840681802] |2.5770015768443706|
|7   |[12.529680840681802, 15.77393361200483] |3.244252771323028 |
|8   |[15.77393361200483, 19.858205868107035] |4.084272256102205 |
|9   |[19.858205868107035, 24.999999999999996]|5.141794131892961 |
|10  |[24.999999999999996, 31.473135294854174]|6.473135294854178 |
+----+----------------------------------------+------------------+

Parsing tomo100M.par_20856: --> data1=/global/cscratch1/sd/plaszczy/tomo100M.parquet
Parsing tomo100M.par_20856: --> ra_name=RA
Parsing tomo100M.par_20856: --> dec_name=DEC
reading input data=/global/cscratch1/sd/plaszczy/tomo100M.parquet
root
 |-- RA: float (nullable = true)
 |-- DEC: float (nullable = true)
 |-- z: float (nullable = true)

input data size=97736948
Parsing tomo100M.par_20856: --> tilingR=SARSPix
53055810

reduced data: 11.1s (0.18min)
----------------------------------------
Parsing tomo100M.par_20856: --> tilingJ=SARSPix
joining pixelization sarspix(128): NpixJ=98304

source #part=1440
root
 |-- w: long (nullable = false)
 |-- ipix: integer (nullable = false)
 |-- id: long (nullable = false)
 |-- x_s: double (nullable = true)
 |-- y_s: double (nullable = true)
 |-- z_s: double (nullable = true)

*** caching source: w, ipix, id, x_s, y_s, z_s
Source size=53.06 M

input source: 4.3s (0.07min)
----------------------------------------
+---+------+-----------+-------------------+--------------------+-------------------+
|  w|  ipix|         id|                x_s|                 y_s|                z_s|
+---+------+-----------+-------------------+--------------------+-------------------+
|  1| 65794|25769804088|0.13920126906425215|-0.14304083186429586| 0.9798787308184987|
|  2| 65794|25769804333|0.13467917619538558| -0.1435102325390077| 0.9804419068236181|
|  4|127425|25769804909|0.07127195971824402| 0.40121745854597834|-0.9132058139958523|
|  2| 79245|25769805927| 0.5837014854991677|-0.02725359087186...|-0.8115108240871798|
|  4| 79245|25769806095| 0.5833892613317253|-0.02382940024449...|-0.8118430448349062|
+---+------+-----------+-------------------+--------------------+-------------------+
only showing top 5 rows

*** caching duplicates: w2, id2, x_t, y_t, z_t, ipix
duplicates size=477.49 M
+---+-----------+-------------------+------------------+--------------------+-----+
| w2|        id2|                x_t|               y_t|                 z_t| ipix|
+---+-----------+-------------------+------------------+--------------------+-----+
|  5|17180028161|-0.8595607225026777|0.5091234464689304|-0.04414386238507...|22362|
|  3|17180114047|-0.8575398739470318| 0.511940465132716| -0.0504214711269649|22362|
|  1|17180114057|-0.8588633518206876|0.5097133789551014|-0.05045804409117423|22362|
|  1|17180114058|-0.8568906090027782|0.5130626296985301|-0.05005219485374...|22362|
|  1|17180114059|-0.8578061486925298|0.5115963242841035|-0.04937420626485066|22362|
+---+-----------+-------------------+------------------+--------------------+-----+
only showing top 5 rows


dup cache: 8.3s (0.14min)
----------------------------------------
dup partitions=1440
edges numParts=1440
==> joining bin, prod

join: 0.5s (0.01min)
----------------------------------------
#bins=6
+---+-----------+
|bin|       Nbin|
+---+-----------+
|  0| 4820614147|
|  1| 7436640102|
|  2|11353806206|
|  3|17448008463|
|  4|26579894562|
|  5|40730263699|
+---+-----------+


binning: 34.1s (0.57min)
----------------------------------------
TOT TIME=0.9715195099 mins
Summary: ************************************
@sarspix(128)
@sarspix(3782)
x@ imin imax Ndata Ndup nedges nbaseD NpixD nbaseJ NpixJ nodes part1 part2 part3 tr ts td tj tb t
r@@ 5 10 97736948 477488790 1.08369e+11 3782 85821144 128 98304 16 1440 1440 1440 11 4 8 0 34 0.97
+----+----------------------------------------+------------------+-----------+
|ibin|interval                                |width             |Nbin       |
+----+----------------------------------------+------------------+-----------+
|5   |[7.905694150420946, 9.952679263837432]  |2.0469851134164854|4820614147 |
|6   |[9.952679263837432, 12.529680840681802] |2.5770015768443706|7436640102 |
|7   |[12.529680840681802, 15.77393361200483] |3.244252771323028 |11353806206|
|8   |[15.77393361200483, 19.858205868107035] |4.084272256102205 |17448008463|
|9   |[19.858205868107035, 24.999999999999996]|5.141794131892961 |26579894562|
|10  |[24.999999999999996, 31.473135294854174]|6.473135294854178 |40730263699|
+----+----------------------------------------+------------------+-----------+

+------------+
|   sum(Nbin)|
+------------+
|108369227179|
+------------+

